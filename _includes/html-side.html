{%- comment -%}
  Responsive figure helper used across posts. Accepts the following parameters:
    - img: image path relative to the post's `media_subpath` (required)
    - caption: optional manual caption; defaults to `_data/img-info.json` lookup
    - align: layout keyword (left, left-33, left-50, right, right-33, right-50,
              center, center-wide, center-full, full, none).
              Defaults to center-full; `full` is an alias of `center-full`.
    - alt: override the alt text (defaults to image filename)
    - title: override the title attribute (defaults to caption)
    - extra_classes / figure_classes: add extra classes to the `<figure>`
    - img_classes: add extra classes to the `<img>`
    - caption_classes: add extra classes to the `<figcaption>`
    - style: append inline styles to the `<figure>`

  Layout is implemented using custom `sjg-figure-*` classes defined in
  `_sass/post.scss`, rather than Bootstrap utility classes, so behavior is
  consistent in both development and production builds.
{%- endcomment -%}

{% assign img_meta = site.data.img-info[include.img] %}
{% assign caption = include.caption | default: img_meta.title %}
{% assign align = include.align | default: "center-full" %}
{% assign img_loading = include.loading | default: "lazy" %}
{% assign img_decoding = include.decoding | default: "async" %}
{% assign img_fetchpriority = include.fetchpriority | default: "low" %}
{% assign img_srcset = include.srcset | default: "" %}
{% assign img_sizes = include.sizes | default: "" %}

{% assign figure_classes = "figure sjg-figure" %}
{% assign figure_styles = "" %}
{% assign img_classes = "figure-img img-fluid rounded" %}
{% assign caption_classes = "figure-caption text-center" %}

{% case align %}
  {% when "left" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-left sjg-figure-66" %}
  {% when "left-33" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-left sjg-figure-33" %}
  {% when "left-50" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-left sjg-figure-50" %}
  {% when "right" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-right sjg-figure-66" %}
  {% when "right-33" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-right sjg-figure-33" %}
  {% when "right-50" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-right sjg-figure-50" %}
  {% when "center" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-center sjg-figure-75" %}
  {% when "center-wide" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-center sjg-figure-90" %}
  {% when "center-full" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-center sjg-figure-100" %}
  {% when "full" %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-center sjg-figure-100" %}
  {% when "none" %}
    {# no additional layout classes #}
  {% else %}
    {% assign figure_classes = figure_classes | append: " sjg-figure-center sjg-figure-100" %}
{% endcase %}

{% if include.extra_classes %}
  {% assign figure_classes = figure_classes | append: " " | append: include.extra_classes %}
{% endif %}
{% if include.figure_classes %}
  {% assign figure_classes = figure_classes | append: " " | append: include.figure_classes %}
{% endif %}

{% if include.img_classes %}
  {% assign img_classes = img_classes | append: " " | append: include.img_classes %}
{% endif %}
{% if include.caption_classes %}
  {% assign caption_classes = caption_classes | append: " " | append: include.caption_classes %}
{% endif %}

{% if include.style %}
  {% capture figure_styles %}{{ figure_styles }} {{ include.style }}{% endcapture %}
{% endif %}
{% assign figure_styles = figure_styles | strip %}

{% assign alt_text = include.alt | default: img_meta.title | default: include.img %}
{% assign title_text = include.title | default: caption %}

<div style="height: 0.001rem;"></div>
<figure class="{{ figure_classes | strip }}"{% if figure_styles != "" %} style="{{ figure_styles }}"{% endif %}>
  <img
    src="{{ include.img }}"
    alt="{{ alt_text | escape }}"
    title="{{ title_text | escape }}"
    class="{{ img_classes | strip }}"
    loading="{{ img_loading }}"
    decoding="{{ img_decoding }}"
    fetchpriority="{{ img_fetchpriority }}"
    {% if img_srcset != "" %}
      srcset="{{ img_srcset | escape }}"
    {% endif %}
    {% if img_sizes != "" %}
      sizes="{{ img_sizes | escape }}"
    {% endif %}
    {% if img_meta and img_meta.width and img_meta.height %}
      width="{{ img_meta.width }}" height="{{ img_meta.height }}"
    {% endif %}
  >
  <figcaption class="{{ caption_classes | strip }}">{{ caption }}</figcaption>
</figure>
