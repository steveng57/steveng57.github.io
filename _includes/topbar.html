<!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      {%- comment -%}
        Derive breadcrumb from the same category structure used in the sidebar.
      {%- endcomment -%}

      {%- assign page_cats = page.category | default: page.categories -%}
      {%- if page_cats == nil and page.category_path -%}
        {%- assign page_cats = page.category_path -%}
      {%- endif -%}

      {%- assign page_topcat = nil -%}
      {%- assign page_subcat = nil -%}
      {%- if page_cats and page_cats.size > 0 -%}
        {%- assign page_topcat = page_cats[0] -%}
        {%- if page_cats.size > 1 -%}
          {%- assign page_subcat = page_cats[1] -%}
        {%- endif -%}
      {%- endif -%}

      {%- comment -%}
        category_path is only present on generated category index pages
        (from category_tree_generator.rb). Posts do not have this.
      {%- endcomment -%}
      {%- assign page_catpath = page.category_path -%}

      {%- comment -%} Home crumb: link on non-root pages, plain text on root {%- endcomment -%}
      <span>
        {% if page.url == '/' %}
          {{ site.data.locales[include.lang].tabs.home | capitalize }}
        {% else %}
          <a href="{{ '/' | relative_url }}">
            {{- site.data.locales[include.lang].tabs.home | capitalize -}}
          </a>
        {% endif %}
      </span>

      {%- comment -%} Top-level category crumb (Woodworking / Home & Garden) {%- endcomment -%}
      {%- assign topcat_url = nil -%}
      {%- if page_topcat == 'Woodworking' -%}
        {%- assign topcat_url = '/woodworking/' -%}
      {%- elsif page_topcat == 'Home & Garden' -%}
        {%- assign topcat_url = '/home-garden/' -%}
      {%- endif -%}

      {%- if topcat_url -%}
        {%- assign on_topcat_index = false -%}
        {%- if page_catpath and page_catpath.size == 1 and page_catpath[0] == page_topcat -%}
          {%- assign on_topcat_index = true -%}
        {%- endif -%}

        <span>
          {% if on_topcat_index %}
            {{ page_topcat }}
          {% else %}
            <a href="{{ topcat_url | relative_url }}">{{ page_topcat }}</a>
          {% endif %}
        </span>
      {%- endif -%}

      {%- comment -%} Second-level category crumb (subcategory under the top-level) {%- endcomment -%}
      {%- assign subcat_url = nil -%}
      {%- if page_subcat -%}
        {%- assign subslug = page_subcat | slugify -%}
        {%- if page_topcat == 'Woodworking' -%}
          {%- assign subcat_url = '/woodworking/' | append: subslug | append: '/' -%}
        {%- elsif page_topcat == 'Home & Garden' -%}
          {%- assign subcat_url = '/home-garden/' | append: subslug | append: '/' -%}
        {%- endif -%}
      {%- endif -%}

      {%- if subcat_url -%}
        <span>{{ page_subcat }}</span>
      {%- endif -%}

      {%- comment -%}
        Final crumb: for non-home pages that are not pure category index pages,
        show the page title (or tab label for tab pages).
      {%- endcomment -%}
      {%- if page.layout != 'home' -%}
        {%- assign is_cat_index = false -%}
        {%- if page_catpath -%}
          {%- assign is_cat_index = true -%}
        {%- endif -%}

        {%- unless is_cat_index -%}
          <span>
            {% if page.collection == 'tabs' or page.layout == 'page' %}
              {%- capture tab_key -%}{{ page.url | split: '/' }}{%- endcapture -%}
              {{ site.data.locales[include.lang].tabs[tab_key] | default: page.title }}
            {% else %}
              {{ page.title }}
            {% endif %}
          </span>
        {%- endunless -%}
      {%- endif -%}
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      {% if page.layout == 'home' %}
        {{- site.data.locales[include.lang].title | default: site.title -}}
      {% elsif page.collection == 'tabs' or page.layout == 'page' %}
        {%- capture tab_key -%}{{ page.url | split: '/' }}{%- endcapture -%}
        {{- site.data.locales[include.lang].tabs[tab_key] | default: page.title -}}
      {% else %}
        {{- site.data.locales[include.lang].layout[page.layout] | default: page.layout | capitalize -}}
      {% endif %}
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="{{ site.data.locales[include.lang].search.hint | capitalize }}..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">
      {{- site.data.locales[include.lang].search.cancel -}}
    </button>
  </div>
</header>
