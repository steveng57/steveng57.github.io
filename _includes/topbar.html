<!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100">
    <nav id="breadcrumb" aria-label="Breadcrumb">
      {%- comment -%}
      Derive breadcrumbs from categories and generated category paths.
      Rules:
      - All crumbs are links except the last, which is plain text.
      - Category index pages use `page.category_path` (from
      `category_tree_generator.rb`), so the last category name is
      the current page.
      - Posts and pages with categories link through their category
      hierarchy, then end with the page title as plain text.
      {%- endcomment -%}

      {%- assign page_catpath = page.category_path -%}
      {%- assign page_cats = page.category | default: page.categories -%}
      {%- if page_cats == nil and page_catpath -%}
      {%- assign page_cats = page_catpath -%}
      {%- endif -%}

      {%- comment -%} Home crumb: link on non-root pages, plain text on root {%- endcomment -%}
      <span>
        {% if page.url == '/' %}
        {{ site.data.locales[include.lang].tabs.home | capitalize }}
        {% else %}
        <a href="{{ '/' | relative_url }}">
          {{- site.data.locales[include.lang].tabs.home | capitalize -}}
        </a>
        {% endif %}
      </span>

      {%- if page_catpath and page_catpath.size > 0 -%}
      {%- comment -%}
      Category index pages: walk `category_path` and build a chain of
      category crumbs, where only the last (current page) is plain.
      {%- endcomment -%}
      {%- assign crumb_dir = '' -%}
      {%- for name in page_catpath -%}
      {%- assign slug = name | slugify -%}
      {%- assign crumb_dir = crumb_dir | append: '/' | append: slug -%}
      <span>
        {% if forloop.last %}
        {{ name }}
        {% else %}
        <a href="{{ crumb_dir | append: '/' | relative_url }}">{{ name }}</a>
        {% endif %}
      </span>
      {%- endfor -%}
      {%- else -%}
      {%- comment -%}
      Posts and standalone pages: link through any categories, then
      end with the page title (or tab label) as the final, plain crumb.
      {%- endcomment -%}

      {%- if page_cats and page_cats.size > 0 -%}
      {%- assign crumb_dir = '' -%}
      {%- for name in page_cats -%}
      {%- assign slug = name | slugify -%}
      {%- assign crumb_dir = crumb_dir | append: '/' | append: slug -%}
      <span>
        <a href="{{ crumb_dir | append: '/' | relative_url }}">{{ name }}</a>
      </span>
      {%- endfor -%}
      {%- endif -%}

      {%- if page.layout != 'home' and page.url != '/' -%}
      <span>
        {% if page.collection == 'tabs' or page.layout == 'page' %}
        {%- capture tab_key -%}{{ page.url | split: '/' }}{%- endcapture -%}
        {{ site.data.locales[include.lang].tabs[tab_key] | default: page.title }}
        {% else %}
        {{ page.title }}
        {% endif %}
      </span>
      {%- endif -%}
      {%- endif -%}
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      {% if page.layout == 'home' %}
        {%- if page.category_path and page.category_path.size > 0 and page.title -%}
          {{- page.title -}}
        {%- else -%}
          {{- site.data.locales[include.lang].title | default: site.title -}}
        {%- endif -%}
      {% elsif page.layout == 'post' %}
        {{- page.title -}}
      {% elsif page.collection == 'tabs' or page.layout == 'page' %}
        {%- capture tab_key -%}{{ page.url | split: '/' }}{%- endcapture -%}
        {{- site.data.locales[include.lang].tabs[tab_key] | default: page.title -}}
      {% else %}
        {{- site.data.locales[include.lang].layout[page.layout] | default: page.layout | capitalize -}}
      {% endif %}
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off"
        placeholder="{{ site.data.locales[include.lang].search.hint | capitalize }}...">
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">
      {{- site.data.locales[include.lang].search.cancel -}}
    </button>
  </div>
</header>