{%- comment -%}
  Side-by-side image helper. Parameters:
    - img1 / img2: image paths relative to the post `media_subpath` (required)
    - caption1 / caption2: optional captions; default to `_data/img-info.json`
    - alt1 / alt2: override alt text for each image
    - title1 / title2: override title attribute
    - align: optional sizing helper; use `equal-33`, `equal-50` (alias `equal`),
             `equal-66`, `equal-75`, or `equal-height` to give both figures matching widths
             or matching heights.
             Defaults to natural image sizing (unchanged from legacy behavior).
    - wrapper_classes: additional classes for the outer flex container
    - figure_classes: base classes applied to both `<figure>` elements
    - figure1_classes / figure2_classes: per-figure overrides
    - img1_classes / img2_classes: extra classes on each `<img>`
    - caption_classes: extra classes on both captions

  Horizontal spacing between figures uses custom `sjg-sxs-left`/`sjg-sxs-right`
  classes defined in `_sass/post.scss` instead of Bootstrap margin utilities,
  so behavior is consistent in both development and production.
{%- endcomment -%}

{% assign img1_meta = site.data.img-info[include.img1] %}
{% assign img2_meta = site.data.img-info[include.img2] %}

{% assign caption1 = include.caption1 | default: img1_meta.title %}
{% assign caption2 = include.caption2 | default: img2_meta.title %}

{% assign align = include.align | default: "" %}
{% assign size_class = "" %}
{% assign figure1_style = "" %}
{% assign figure2_style = "" %}

{% case align %}
  {% when "equal", "equal-50" %}
    {% assign size_class = " sjg-sxs-equal-50" %}
  {% when "equal-33" %}
    {% assign size_class = " sjg-sxs-equal-33" %}
  {% when "equal-66" %}
    {% assign size_class = " sjg-sxs-equal-66" %}
  {% when "equal-75" %}
    {% assign size_class = " sjg-sxs-equal-75" %}
  {% when "equal-height" %}
    {% assign size_class = " sjg-sxs-equal-height" %}
    {% if img1_meta.width and img1_meta.height and img2_meta.width and img2_meta.height %}
      {% assign w1 = img1_meta.width | times: 1.0 %}
      {% assign h1 = img1_meta.height | times: 1.0 %}
      {% assign w2 = img2_meta.width | times: 1.0 %}
      {% assign h2 = img2_meta.height | times: 1.0 %}
      {% assign ar1 = w1 | divided_by: h1 %}
      {% assign ar2 = w2 | divided_by: h2 %}
      {% assign total_ar = ar1 | plus: ar2 %}
      {% assign pct1 = ar1 | divided_by: total_ar | times: 100 %}
      {% assign pct2 = ar2 | divided_by: total_ar | times: 100 %}
      {% assign figure1_style = "--sxs-width: " | append: pct1 | append: "%" %}
      {% assign figure2_style = "--sxs-width: " | append: pct2 | append: "%" %}
    {% endif %}
  {% else %}
    {% assign size_class = "" %}
{% endcase %}

{% assign wrapper_classes = include.wrapper_classes | default: "d-flex flex-column flex-md-row justify-content-center align-items-center gap-2 mb-3" %}

{% assign base_figure_classes = include.figure_classes | default: "figure d-inline-flex flex-column align-items-center text-center mb-0" %}

{% if include.figure1_classes %}
  {% assign figure1_classes = include.figure1_classes %}
{% else %}
  {% assign figure1_classes = base_figure_classes | append: " sjg-sxs-left" %}
{% endif %}

{% if include.figure2_classes %}
  {% assign figure2_classes = include.figure2_classes %}
{% else %}
  {% assign figure2_classes = base_figure_classes | append: " sjg-sxs-right" %}
{% endif %}

{% if size_class != "" %}
  {% assign figure1_classes = figure1_classes | append: size_class %}
  {% assign figure2_classes = figure2_classes | append: size_class %}
{% endif %}

{% assign image_base_classes = "figure-img img-fluid rounded" %}

{% assign img1_classes = image_base_classes %}
{% if include.img1_classes %}
  {% assign img1_classes = img1_classes | append: " " | append: include.img1_classes %}
{% endif %}

{% assign img2_classes = image_base_classes %}
{% if include.img2_classes %}
  {% assign img2_classes = img2_classes | append: " " | append: include.img2_classes %}
{% endif %}

{% assign caption_classes = "figure-caption text-center" %}
{% if include.caption_classes %}
  {% assign caption_classes = caption_classes | append: " " | append: include.caption_classes %}
{% endif %}

{% assign alt1 = include.alt1 | default: img1_meta.title | default: include.img1 %}
{% assign alt2 = include.alt2 | default: img2_meta.title | default: include.img2 %}
{% assign title1 = include.title1 | default: caption1 %}
{% assign title2 = include.title2 | default: caption2 %}

<div class="{{ wrapper_classes | strip }}">
  <figure class="{{ figure1_classes | strip }}" style="{{ figure1_style }}">
    <img
      src="{{ include.img1 }}"
      alt="{{ alt1 | escape }}"
      title="{{ title1 | escape }}"
      class="{{ img1_classes | strip }}"
      {% if img1_meta and img1_meta.width and img1_meta.height %}
        width="{{ img1_meta.width }}" height="{{ img1_meta.height }}"
      {% endif %}
    >
    <figcaption class="{{ caption_classes | strip }}">{{ caption1 }}</figcaption>
  </figure>
  <figure class="{{ figure2_classes | strip }}" style="{{ figure2_style }}">
    <img
      src="{{ include.img2 }}"
      alt="{{ alt2 | escape }}"
      title="{{ title2 | escape }}"
      class="{{ img2_classes | strip }}"
      {% if img2_meta and img2_meta.width and img2_meta.height %}
        width="{{ img2_meta.width }}" height="{{ img2_meta.height }}"
      {% endif %}
    >
    <figcaption class="{{ caption_classes | strip }}">{{ caption2 }}</figcaption>
  </figure>
</div>

